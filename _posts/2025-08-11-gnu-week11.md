---
layout: post
title: Multiple Recording Feature
date: 2025-08-11 1:00:00
description: This week’s focus was implementing multiple recording functionality in the application.
tags: gnuradio
categories: gsoc-updates
featured: false
images:
  compare: true
  slider: true
---

## FM Receiver App – Week 11 Update

This week’s progress:

1. Added **Multiple Recording** feature (in development)  
2. New **Station Button** widget  
3. Auto-select SDR if only one device detected  
4. Fixed flowgraph crash on app close  
5. New **Info Window** widget for notifications  

---

### Multiple Recording Feature

The app now supports concurrent recording of multiple stations in the background, limited by SDR bandwidth (RTL-SDR: 2 MHz).  
At most, it can handle three 200 kHz FM stations with 100 kHz separation. Bandwidth constraints mean users can only record streams within their SDR’s range.

The initial plan used a **polyphase channelizer** to split FM channels, directing selected ones to WAV sinks and others to null sinks.

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/gnu_radio/week11/flowgraph.png" class="img-fluid rounded z-depth-1" %}
    </div>
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/gnu_radio/week11/flowgraph2.png" class="img-fluid rounded z-depth-1" %}
    </div>
</div>

#### Why this approach failed

With stations at 88.7 MHz and 88.2 MHz, the 200 kHz step missed some channels, while a 100 kHz step captured far more than needed.  
Instead, I switched to **frequency shifting with offsets**.

#### Hierarchical Block Solution

I built a hierarchical block that:
- Accepts an input stream  
- Frequency-shifts and isolates a station  
- Demodulates  
- Saves output to a WAV file  

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/gnu_radio/week11/recorder.png" class="img-fluid rounded z-depth-1" %}
    </div>
</div>

A **multiple recorder** function attaches/detaches these blocks to/from the SDR source via station record buttons. It checks if the station’s frequency is within bandwidth before recording.

```python
# Code snippet

            # Create and store the recorder instance, tuned with frequency offset
            self.recorders.append(
                MultipleRecorder(
                    fname=file_name,
                    freq=self.get_freq() + int(freq_off),
                    freq_offset=int(freq_off),
                )
            )

            # Connect FM receiver's output channel to the new recorder
            self.fm_receiver.connect(
                (self.fm_receiver.blocks_selector_0, 1),
                (self.recorders[0], 0)
            )
```

After testing, the recordings work as expected.

---

### New Station Buttons

Station buttons are now a dedicated class handling station deletion, recording, and selection.

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/gnu_radio/week11/station_btn.png" class="img-fluid rounded z-depth-1" %}
    </div>
</div>

---

### Auto-select SDR

If only one SDR device is available, the app now selects it automatically.

---

### Fixed Config Manager

The config manager wasn’t saving because the close event method name was wrong.  
After renaming it to `def closeEvent(self, event):`, configuration saving/loading now works.

---

### Notification Window

A new notification class alerts the user when an action isn’t possible—e.g., trying to record a station outside the current SDR bandwidth.

<div class="row">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/gnu_radio/week11/notification.png" class="img-fluid rounded z-depth-1" %}
    </div>
</div>

---

### Known Issues

- **Center frequency changes during recording** cause some channels to record noise.  
  Plan: stop all active recordings if the user changes the tuned station.  
  Example: Recording 88.5 and 88.7 MHz, then tuning to 107 MHz will result in noise.

- **Hardcoded SDR bandwidth & decimation** (currently 1.92 MHz).  
  Changing sample rate breaks FM demod and audio. Possible fix: use a rational resampler to standardize flowgraph input rates.

---

### Next Steps

- Implement “stop all recordings” on frequency change  
- Improve documentation  
- Enhance FM detection  
- Wrap project up for final submission

---

**Useful Links**

- [Project Repo](https://github.com/StudHamza/GNU-Radio-FM-App)  
- [All Weekly Blogs](https://studhamza.github.io/hamza-folio/blog/tag/gnuradio/)
